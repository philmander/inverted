<!DOCTYPE html>
<html>
<head>
<title>Require Test</title>

<script src="http://yui.yahooapis.com/combo?3.3.0/build/yui/yui-min.js"></script>

<script> window.DEBUG = true; </script>
<script src="../../main/util/Namespace.js"></script>
<script src="../../main/util/Util.js"></script>
<script src="../../main/util/Require.js"></script>

</head>
<body>
<script>
    YUI().use("test", function(Y){
    	
       	window.test;
        var protoFactory;
        var testCase = new Y.Test.Case({
            name : "Require Test",

            setUp : function(){				         
                
            	window.test = {};
            },

            tearDown : function(){

                protoFactory = null;
            },
		          
            testGet : function(){
            	
            	var scripts = [
            	    "../resources/RequireTest1.js",
            	    "../resources/RequireTest2.js",
            	    "../resources/RequireTest3.js",
            	];
            	
            	Y.Assert.isUndefined(test.RequireTest1);
            	Y.Assert.isUndefined(test.RequireTest2);
            	Y.Assert.isUndefined(test.RequireTest3);
            	
            	var require = new inverted.util.Require(1000);
            	require.load(scripts, function(success) {
            		
					Y.Assert.isTrue(success);		            		
            		Y.Assert.isNotUndefined(test.RequireTest1);
                	Y.Assert.isNotUndefined(test.RequireTest2);
                	Y.Assert.isNotUndefined(test.RequireTest3);
            	});
            },

			testGet404 : function(){
            	
            	var scripts = [
            	    "../resources/RequireTest1.js",
            	    "../resources/RequireTest2.js",
            	    "../resources/RequireTest3.js",
            	    
            	    //do not work
            	    "../resources/RequireTest400.js",
            	    "../resources/RequireTest404.js",
            	];
            	
            	var require = new inverted.util.Require(1000);
            	
            	var _success, _notLoaded, _message;            	
           		require.load(scripts, function(success, notLoaded, message) {
           			_success = success;
           			_notLoaded = notLoaded;
           			_message = message;           			
           		});	
           		
           		this.wait(function()
           		{
           			Y.Assert.isFalse(_success);
           			Y.Assert.isArray(_notLoaded);
           			Y.Assert.isString(_message);
           			Y.Assert.areEqual(2, _notLoaded.length);
           		}, 1200);
            },
           
			testGetMultiple : function(){
				
				//TODO: fails if same instane of Require is used for each load
            	
            	var require1 = new inverted.util.Require(3000);
            	var require2 = new inverted.util.Require(3000);
            	var require3 = new inverted.util.Require(3000);
            	
            	var _success1, _notLoaded1, _message1, 
            		_success2, _notLoaded2, _message2, 
            		_success3, _notLoaded3, _message3;
            	
           		require1.load("../resources/RequireTest1.js", function(success, notLoaded, message) {
           			
           			console.log(success, notLoaded, message);
           			_success1 = success;
           			_notLoaded1 = notLoaded;
           			_message1 = message;           			
           		});	
           		require2.load("../resources/RequireTest2.js", function(success, notLoaded, message) {
           			
           			console.log(success, notLoaded, message);
           			_success2 = success;
           			_notLoaded2 = notLoaded;
           			_message2 = message;           			
           		});	
           		require3.load("../resources/RequireTest3.js", function(success, notLoaded, message) {
           			
           			console.log(success, notLoaded, message);
           			_success3 = success;
           			_notLoaded3 = notLoaded;
           			_message3 = message;           			
           		});	
           		
           		this.wait(function()
           		{
           			Y.Assert.isTrue(_success1, "success1");
           			Y.Assert.isArray(_notLoaded1, "notloaded1");
           			Y.Assert.isString(_message1, "message1");
           			Y.Assert.isTrue(_success2, "success2");
           			Y.Assert.isArray(_notLoaded2, "notloaded2");
           			Y.Assert.isString(_message2, "success2");
           			Y.Assert.isTrue(_success3, "success3");
           			Y.Assert.isArray(_notLoaded3, "notloaded3");
           			Y.Assert.isString(_message3, "success3");           			
           		}, 4000);
            }
        });

        Y.Test.Runner.add(testCase);

        var TestRunner = Y.Test.Runner;
        TestRunner.run();

    });
</script>
</body>
</html>
